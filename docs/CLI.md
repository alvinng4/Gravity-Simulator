# Command-line interface (CLI) documentation for Gravity-Simulator

* [Quick Start](#quick-start)
    - [Prerequisite](#prerequisite)
    - [Installation](#installation)
    - [Some notes](#some-notes)
* [Running the program in terminal](#running-the-program-in-terminal)
* [Built-in systems](#built-in-systems)
* [Integrators](#integrators)
    - [Simple methods](#simple-methods)
    - [Embedded Runge-Kutta methods](#embdedded-runge-kutta-methods)
    - [IAS15](#IAS15)
    - [WHFast](#whfast)
* [Making changes to saved systems](#making-changes-to-saved-systems)
* [Saving the results](#saving-the-results)

## Quick Start

### Prerequisite

1. Python version 3.10 or higher. 
2. Any C compiler that supports C99 (May not be needed if the program runs successfully)

### Installation
1. Download the source files, or clone this repository by running the following command in terminal:
    ```
    git clone https://github.com/alvinng4/Gravity-Simulator
    ```
2. Install the required packages by
    ```
    pip install .
    ```
    If the installation is not successful, install the following packages manually:
    ```
    matplotlib==3.8.3
    numpy==1.26.4
    rich==13.7.1
    ```
3. Compile the C library

    I have provided a compilation of the C library in the repository. If it does not run on your computer,
    you may need to recompile it.

    To compile the C library, simply go to the src folder and run
    ```
    make [CC=gcc]
    ```
### Some notes
* The default unit for this project is solar masses, AU and days, with $G = 0.00029591220828411956 \text{ M}_\odot^{-1} \text{ AU}^3 \text{ day}^{-2}$.
* Animations, simulation results, etc. will be stored to `gravity_sim/result` by default
* Only built-in systems are provided for CLI. For customizing systems, please use the API. 

## Running the program in terminal

Once the installation is completed, navigate to the source directory in terminal and run
```
python -m gravity_sim [-s|--save_plots] [-c|--c_lib-path]
```
Optional arguments:

* `-s` or `--save_plots`: to save the plots generated by the program instead of showing them in a window.

* `-c` or `--c_lib-path`: to specify the path to the C library, in case the default path is not working. 


## Built-in systems

| System | Description |
|:-------|:------------| 
| circular_binary_orbit | A circular orbit formed by two stars |
| eccentric_binary_orbit | An eccentric orbit formed by two stars |
| 3d_helix | An upward helix consists of three stars |
| sun_earth_moon | The Sun, Earth, and Moon system |
| figure-8 | A "figure-8" orbit involving three stars  |
| pyth-3-body | Three stars arranged in a triangle with length ratios of 3, 4, and 5. It is a highly chaotic orbit with close encounters that can be used to test the difference between fixed and variable step size integrators. |
| solar_system | Solar System with the Sun and the planets |
| solar_system_plus | solar_system with the inclusion of Pluto, Ceres, and Vesta  |

## Integrators 
### Simple methods
Below are four simple fixed step size methods to simulate the system with a given step size $\text{d}t$.
| Simple methods |
|:-----------|
| Euler |
| Euler Cromer |
| Fourth Order Runge-Kutta (RK4) |
| Leapfrog |

### Embedded Runge-Kutta methods
Embedded RK methods are adaptive methods that decides the step size automatically based on the estimated error.
It can resolve close encounters but fail to conserve energy over long time scele.

| Embdedded Runge-Kutta methods | Recommended tolerance* |
|:-----------|:-------------|
| Runge–Kutta–Fehlberg 4(5) | $10^{-8}$ to $10^{-14}$ |
| Dormand–Prince method (DOPRI) 5(4) | $10^{-8}$ to $10^{-14}$ |
| Verner's method (DVERK) 6(5) | $10^{-8}$ to $10^{-14}$ |
| Runge–Kutta–Fehlberg 7(8) | $10^{-4}$ to $10^{-8}$ |

*For reference only

### IAS15
IAS15 (Implicit integrator with Adaptive time Stepping, 15th order) is a highly optimized integrator with extremely high accuracy. It is the default method for this project.

The recommended tolerance* is $10^{-9}$. Since the integrator is 15th order, changing the tolerance
results in little improvement in performance, but a huge penalty in accuracy. Therefore, it is not
recommended to change this tolerance.

*For reference only

### WHFast
WHFast is a second order symplectic method with fixed step size, which conserves energy over long integration period. This integrator cannot resolve close encounter.

## Saving the results
The data will be saved in the default unit (solar masses, AU and days), and follow this format:
```
time, dt, total energy, x1, y1, z1, ... vx1, vy1, vz1, ...
```
The saved data file can be read by the program.
However, some information could be missing as we are not saving the information of the gravitational system.
